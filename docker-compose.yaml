version: '3.8'

services:
  # Development service
  ai-server-dev:
    build:
      context: .
      target: dev  # Use the dev stage from Dockerfile
    ports:
      - "5000:5000"
    env_file: .env
    volumes:
      - .:/app  # Mount local code for live reloading
    restart: unless-stopped

  # Testing service
  ai-server-test:
    build:
      context: .
      target: test  # Use the test stage from Dockerfile
    env_file: .env
    
    volumes:
      - .:/app  # Mount local code for running tests
    command: swift test  # Explicitly run tests

  # Production service
  ai-server-prod:
    build:
      context: .
      target: prod  # Use the prod stage from Dockerfile
    env_file: .env
    ports:
      - "5000:5000"
    restart: unless-stopped

volumes:
  ollama_data:
